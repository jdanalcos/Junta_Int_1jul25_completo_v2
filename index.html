<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Junta DirecciÃ³n - 1 Julio 2025</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- FontAwesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="bg-light">
  <div class="container mt-4">
    <h1 class="mb-3 text-center">ðŸ“Š Junta DirecciÃ³n â€“ 1 de julio</h1>

    <!-- Filtros -->
    <div class="row mb-3">
      <div class="col-md-3">
        <select id="filtroEtapa" class="form-select">
          <option value="">Todas las etapas</option>
        </select>
      </div>
      <div class="col-md-3">
        <select id="filtroRegion" class="form-select">
          <option value="">Todas las regiones</option>
        </select>
      </div>
      <div class="col-md-3">
        <select id="filtroCumplido" class="form-select">
          <option value="">Todos</option>
          <option value="true">Cumplidos</option>
          <option value="false">Pendientes</option>
        </select>
      </div>
    </div>

    <!-- Tabla -->
    <div class="table-responsive">
      <table class="table table-bordered table-striped table-hover">
        <thead class="table-dark">
          <tr>
            <th>Etapa</th>
            <th>RegiÃ³n</th>
            <th>Desarrollo</th>
            <th>Tema</th>
            <th>Responsable</th>
            <th>Fecha compromiso</th>
            <th>Observaciones</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="tablaCompromisos"></tbody>
      </table>
    </div>

    <div id="contador" class="text-end text-muted"></div>
  </div>

  <!-- Firebase SDK y Firestore -->
  <script type="module">
    // Importaciones desde Firebase CDN
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import {
      getFirestore,
      collection,
      getDocs
    } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";

    // ConfiguraciÃ³n de tu proyecto Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAuWx1X51ZlBwIK2MPLUnKDConwEY2j9uA",
      authDomain: "junta-int-1jul25-v1.firebaseapp.com",
      projectId: "junta-int-1jul25-v1",
      storageBucket: "junta-int-1jul25-v1.firebasestorage.app",
      messagingSenderId: "682041011857",
      appId: "1:682041011857:web:891190fd08647a3bce1930"
    };

    // Inicializar Firebase y Firestore
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const tabla = document.getElementById("tablaCompromisos");
    const filtroEtapa = document.getElementById("filtroEtapa");
    const filtroRegion = document.getElementById("filtroRegion");
    const filtroCumplido = document.getElementById("filtroCumplido");
    const contador = document.getElementById("contador");

    let datos = [];

    async function obtenerCompromisos() {
      const querySnapshot = await getDocs(collection(db, "Compromisos_24junio"));
      datos = [];
      tabla.innerHTML = "";
      const etapas = new Set();
      const regiones = new Set();

      querySnapshot.forEach(doc => {
        const data = doc.data();
        data.id = doc.id;
        datos.push(data);
        etapas.add(data.etapa);
        regiones.add(data.region);
      });

      // Llenar filtros
      llenarSelect(filtroEtapa, etapas);
      llenarSelect(filtroRegion, regiones);

      filtrarYMostrar();
    }

    function llenarSelect(select, valores) {
      select.innerHTML += [...valores]
        .sort()
        .map(v => `<option value="${v}">${v}</option>`)
        .join('');
    }

    function filtrarYMostrar() {
      const etapaSel = filtroEtapa.value;
      const regionSel = filtroRegion.value;
      const cumplidoSel = filtroCumplido.value;

      const filtrados = datos.filter(d => {
        return (!etapaSel || d.etapa === etapaSel)
          && (!regionSel || d.region === regionSel)
          && (!cumplidoSel || d.cumplido === (cumplidoSel === "true"));
      });

      tabla.innerHTML = filtrados.map(d => `
        <tr>
          <td>${d.etapa}</td>
          <td>${d.region}</td>
          <td>${d.desarrollo}</td>
          <td>${d.tema}</td>
          <td>${d.responsable}</td>
          <td>${d.fechaCompromiso}</td>
          <td>${d.observaciones || ""}</td>
          <td>
            <i class="fa-solid fa-circle-check text-success me-2" title="Marcar como cumplido"></i>
            <i class="fa-solid fa-pen text-primary me-2" title="Editar"></i>
            <i class="fa-solid fa-trash text-danger" title="Eliminar"></i>
          </td>
        </tr>`).join('');

      contador.textContent = `Total: ${filtrados.length} compromiso(s)`;
    }

    filtroEtapa.addEventListener("change", filtrarYMostrar);
    filtroRegion.addEventListener("change", filtrarYMostrar);
    filtroCumplido.addEventListener("change", filtrarYMostrar);

    obtenerCompromisos();
  </script>

<!-- Scripts de Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.min.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAuWx1X51ZlBwIK2MPLUnKDConwEY2j9uA",
    authDomain: "junta-int-1jul25-v1.firebaseapp.com",
    projectId: "junta-int-1jul25-v1",
    storageBucket: "junta-int-1jul25-v1.appspot.com",
    messagingSenderId: "682041011857",
    appId: "1:682041011857:web:891190fd08647a3bce1930"
  };

  firebase.initializeApp(firebaseConfig);
</script>

</body>
</html>
